PROC S_PAR_INI SBLOF DISPLOF
;参数初始化

DRFOF;手轮偏置清除
INI[25]=1;退刀计算标志位置1

;螺旋升角值
IF INI[0]==0;右旋
	INI[20]=-(INI[17]+INI[18]/60+INI[19]/3600);计算升角值
ELSE
	INI[20]=INI[17]+INI[18]/60+INI[19]/3600;计算升角值
ENDIF

IF GRIND[0]==1;是内螺纹磨削
	INI[6]=INI[2]
	INI[7]=INI[1]
ELSE;不是内螺纹磨削
	IF INI[0]==1;左旋
		INI[6]=INI[1]
		INI[7]=INI[2]
	ELSE;右旋
		INI[6]=INI[2];磨削起点
		INI[7]=INI[1];磨削终点
	ENDIF
ENDIF

INI[3]=INI[2]-INI[1];磨削长度
INI[5]=WORK[0]*INI[4];导程
INI[9]=360*(INI[3]-INI[24])/INI[5];磨削总角度
INI[8]=(INI[2]+INI[1])/2;磨削中点

;锥度相关计算
IF INI[11]==0;判断有无锥度
	INI[14]=0;锥度值
ELSE
	INI[14]=INI[12]/INI[13]
ENDIF

INI[15]=INI[3]*INI[14]/2;X方向的增量
;-----------
DRESSER[6]=0;报警标记取消
PROCESS[3]=0;修整标记清零
PROCESS[7]=0;当前磨削是否修整累计
TECH_TIME[0]=0;当前粗磨次数
TECH_TIME[1]=0;当前半粗磨次数
TECH_TIME[2]=0;当前半精磨次数
TECH_TIME[3]=0;当前精磨次数
TECH_TIME[4]=0

WORK[1]=0;当前磨削头数

;-----------
;X轴初始接触赋值位置选择
IF PROCESS[0]==0;选择界面工艺时执行判断,选择DIY时在DIY内执行判断
	PROCESS[2]=0
	IF INI[26]<>0;0是单件磨削模式,1是批量磨削模式
		PROCESS[4]=PROCESS[13];砂轮1当前等于初始
		PROCESS[15]=PROCESS[16];砂轮2当前等于初始
		PROCESS[14]=0;工艺累积进刀清零
	ENDIF
ELSE
	PROCESS[2]=4
ENDIF
;-----------
;报警判断
IF INI[3]<=0;磨削长度<=0
	DRESSER[6]=1;工件左端坐标>工件右端坐标
ENDIF
IF DRESSER[24]<DRESSER[35];当前砂轮1直径<最小砂轮1直径
	DRESSER[6]=2;砂轮1过小,请更换砂轮
ENDIF
IF DRESSER[38]<DRESSER[44];当前砂轮2直径<最小砂轮2直径
	DRESSER[6]=3;砂轮2过小,请更换砂轮
ENDIF
;
;外圆和端面磨削相关初始化
TECH_TIME[5]=0
TECH_TIME[6]=0
TECH_TIME[7]=0
TECH_TIME[8]=0
TECH_TIME[9]=0
PROCESS[18]=0
IF INI[26]<>0;0是单件磨削模式,1是批量磨削模式
	PROCESS[20]=TOOL_SET[23];批量第二件清除外圆已磨削量
	PROCESS[34]=TOOL_SET[24];左端面...
	PROCESS[37]=TOOL_SET[22];右端面...
ENDIF
IF DRESSER[90]<DRESSER[92]
	DRESSER[6]=6;外圆磨砂轮直径过小
ENDIF
RET

