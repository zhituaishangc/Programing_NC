IF MODE[0]==0;磨削
    OPERATION[5]=GRIND[1];当前工件磨削接触位置
    OPERATION[6]=GRIND[6];磨削起点
    OPERATION[7]=GRIND[10];磨削起始旋转轴角度
ELSE;对刀
    WORK[2]=WORK[1];手动对刀下工件中径复位
ENDIF;

OPERATION[3]=$AC_DRF[AXNAME(G_0)];进给轴drf
OPERATION[4]=$AC_DRF[AXNAME(G_1)];直线插补轴drf

OPERATION[8]=OPERATION[5]-(OPERATION[6]-GRIND[6])*WORK[5]/2*ORI_G0;手动对刀开始进给轴对应磨削起点坐标
PERATION[9]=OPERATION[7]-(GRIND[6]-OPERATION[6])/WORK[7]*360*WORK[3];手动对刀开始旋转插补轴对应磨削起点角度

GRIND[0]=(OPERATION[8]+OPERATION[3])-(WHEEL[0]/2*WORK[0]+WORK[2]/2)*ORI_G0;工件中心-砂轮中心基准
GRIND[10]=PERATION[9]+OPERATION[4]/WORK[7]*360*WORK[3];旋转磨削插补轴起始角

U_ANG_WITHIN_360(GRIND[10]);将角度调整到0-360内

DRFOF;

IF $A_DBB[2]==1;按下退刀键
	G90 G64 G01 AX[AXNAME(G_0)]=GRIND[8] F=G0_FAST/2;进给轴加工安全位置
    G90 G01 AX[AXNAME(G_1)]=GRIND[12] F=G1_FAST;台面磨削起始安全位置
    G90 G01 AX[AXNAME(G_0)]=GRIND[11] F=G0_FAST;进给轴结束加工安全位置
ENDIF;

RET;

